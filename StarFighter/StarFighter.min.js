"use strict";var V=function(e,t,i){return new BABYLON.Vector3(+e,+t,+i)},randomSign=function(){return Math.random()-.5<0?-1:1},SF={score:0,level:1,goals:[8,12,18,25,40],killed:0};SF.goal=SF.goals[0],SF.goalMaxNb=SF.goals.length,SF.enemyName="MorVÃ¶rsKers",SF.Assets={flareURL:"assets/flarealpha.png",sightURL:"assets/viseur.png",rustyURL:"assets/rusty.jpg",rustyNormalURL:"assets/rustyNormal.png",universeURL:"assets/stars1.jpg",planetURL:"assets/planetsheet.png",enemyURL1:"assets/enemy.jpg",enemyURL2:"assets/enemy3.jpg",enemyNormalURL1:"assets/enemyNormal.png",enemyNormalURL3:"assets/enemyNormal3.png"},SF.CreateMaterials=function(e){SF.Materials={};var t=new BABYLON.Texture(SF.Assets.flareURL,e);t.hasAlpha=!0;var i=new BABYLON.Texture(SF.Assets.sightURL,e),s=new BABYLON.Texture(SF.Assets.rustyURL,e),a=new BABYLON.Texture(SF.Assets.rustyNormalURL,e),n=new BABYLON.Texture(SF.Assets.enemyURL1,e),o=new BABYLON.Texture(SF.Assets.enemyURL2,e),h=new BABYLON.Texture(SF.Assets.enemyNormalURL1,e),r=new BABYLON.Texture(SF.Assets.enemyNormalURL3,e);o.uScale=.5,o.vScale=o.uScale,r.uScale=o.uScale,r.vScale=o.uScale;var c=new BABYLON.Texture(SF.Assets.universeURL,e);c.uScale=8,c.vScale=c.uScale;var l=new BABYLON.Texture(SF.Assets.planetURL,e),m=new BABYLON.StandardMaterial("um",e);m.alpha=.6,m.freeze(),m.emissiveTexture=c,SF.Materials.universe=m;var p=new BABYLON.StandardMaterial("um",e);p.freeze(),p.diffuseTexture=l,p.specularColor=new BABYLON.Color3(.1,.1,.1),SF.Materials.planets=p;var d=new BABYLON.StandardMaterial("sm",e);d.emissiveColor=BABYLON.Color3.White(),d.diffuseColor=BABYLON.Color3.White(),d.diffuseTexture=t,d.useAlphaFromDiffuseTexture=!0,d.freeze(),SF.Materials.star=d;var g=new BABYLON.StandardMaterial("sm",e);i.hasAlpha=!0,g.emissiveTexture=i,g.diffuseTexture=i,g.useAlphaFromDiffuseTexture=!0,g.freeze(),SF.Materials.sight=g;var S=new BABYLON.StandardMaterial("cm",e);S.diffuseTexture=s,S.bumpTexture=a,SF.Materials.ship=S;var u=new BABYLON.StandardMaterial("shm",e);u.alpha=.5,u.diffuseColor=BABYLON.Color3.Green(),SF.Materials.shield=u;var y=new BABYLON.StandardMaterial("lm",e);y.emissiveColor=BABYLON.Color3.White(),y.freeze(),SF.Materials.laser=y;var L=new BABYLON.StandardMaterial("em1",e);L.emissiveColor=new BABYLON.Color3(1,1,1),L.diffuseTexture=n,L.bumpTexture=h,L.specularPower=48,SF.Materials.enemy1=L;var x=new BABYLON.StandardMaterial("em2",e);x.emissiveColor=new BABYLON.Color3(1,1,1),x.diffuseTexture=o,x.bumpTexture=r,x.specularPower=48,SF.Materials.enemy2=x;var B=new BABYLON.StandardMaterial("im",e);B.emissiveColor=BABYLON.Color3.White(),B.diffuseColor=BABYLON.Color3.White(),B.diffuseTexture=t,B.useAlphaFromDiffuseTexture=!0,B.freeze(),SF.Materials.impact=B},SF.CreateLights=function(e){SF.Lights={};var t=new BABYLON.HemisphericLight("light",V(0,1,-.75),e);t.intensity=.8,t.shadowEnabled=!1,SF.Lights.light=t,SF.Lights.lightInitialIntensity=.8;var i=new BABYLON.PointLight("pointLight",V(0,0,0),e);i.diffuse=new BABYLON.Color3(0,0,1),i.specular=new BABYLON.Color3(.5,.5,1),i.intensity=0,i.shadowEnabled=!1,SF.Lights.pointLight=i,SF.Lights.pointLightMaxIntensity=.6;var s=new BABYLON.PointLight("explosionLight",V(0,0,0),e);s.diffuse=new BABYLON.Color3(1,1,.6),s.specular=new BABYLON.Color3(1,1,.8),s.shadowEnabled=!1,SF.Lights.explLghtIntensity=1,s.intensity=0,SF.Lights.explosionLight=s;var a=new BABYLON.HemisphericLight("light",V(randomSign()*Math.random(),Math.random(),-Math.random()),e);a.shadowEnabled=!1,SF.Lights.spaceLight=a},SF.GUI=function(e){var t=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,e);t.idealWitdh=600,t.renderAtIdealSize=!0;var i=new BABYLON.GUI.TextBlock;i.text="000000",i.color="white",i.fontSize=24,i.textVerticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,t.addControl(i),this.score=i},SF.GUI.prototype.pad=function(e,t){for(var i=String(e);i.length<(t||2);)i="0"+i;return i},SF.Universe=function(e){this.gameScene=e;var t=this.gameScene.scene,i=BABYLON.MeshBuilder.CreateIcoSphere("ico",{radius:5*this.gameScene.distance,subdivisions:4,sideOrientation:BABYLON.Mesh.BACKSIDE},t);i.material=SF.Materials.universe,i.alwaysSelectAsActiveMesh=!0,this.mesh=i},SF.Universe.prototype.animate=function(){this.mesh.rotation.x+=.01*this.gameScene.ang.x,this.mesh.rotation.y-=.01*this.gameScene.ang.y},SF.Planets=function(e,t){this.gameScene=e;var i=this.gameScene.scene,s=1.5*this.gameScene.distance,a=new BABYLON.SolidParticleSystem("plsps",i,{updatable:!1}),n=BABYLON.MeshBuilder.CreateSphere("plmdl",{diameter:10,segments:24},i);a.addShape(n,t,{positionFunction:function(e,t,i){e.position.x=randomSign()*(s+.4*Math.random()),e.position.y=randomSign()*(s+.4*Math.random()),e.position.z=randomSign()*(s+.4*Math.random()),e.rotation.y=6.28*randomSign()*Math.random(),e.rotation.z=.8*randomSign()*Math.random(),e.scaling.x=6*Math.random(),e.scaling.y=e.scaling.x,e.scaling.z=e.scaling.x,e.color=new BABYLON.Color4(.5*Math.random()+.5,.5*Math.random()+.5,.5*Math.random()+.5,1);var a=.5*Math.floor(2*Math.random()),n=.25*Math.floor(4*Math.random());e.uvs.x=a,e.uvs.y=n,e.uvs.z=a+.5,e.uvs.w=n+.25}}),a.buildMesh(),n.dispose(),a.isAlwaysVisible=!0,this.sps=a,this.mesh=a.mesh,this.mesh.material=SF.Materials.planets},SF.Planets.prototype.animate=function(){this.mesh.rotation.x+=.01*this.gameScene.ang.x,this.mesh.rotation.y-=.01*this.gameScene.ang.y,BABYLON.Quaternion.RotationYawPitchRollToRef(this.mesh.rotation.y,this.mesh.rotation.x,0,this.gameScene.quaternion),this.gameScene.quaternion.toRotationMatrix(this.gameScene.rotMatrix),BABYLON.Vector3.TransformNormalToRef(this.gameScene.initialSpaceLightDirection,this.gameScene.rotMatrix,SF.Lights.spaceLight.direction)},SF.Starship=function(e){var t=e.scene;this.gameScene=e,this.cockpitArea=this.gameScene.cockpitArea;for(var i=[],s=0;s<=40;s++){var a=s/20-1,n=-a*a*a*a*1.5+.8,o=2+n;i.push(V(a,n,o))}var h=[V(-1.5,.8,0),V(-.5,-.8,3)],r=[V(1.5,.8,0),V(.5,-.8,3)],c=BABYLON.MeshBuilder.CreateTube("t1",{path:h,radius:.03},t),l=BABYLON.MeshBuilder.CreateTube("t2",{path:r,radius:.03},t),m=BABYLON.MeshBuilder.CreateTube("t3",{path:i,radius:.03},t);this.rpath1=[],this.rpath2=[],this.rpath3=[],this.initialRpath3=[],this.cockpitHeight=this.gameScene.cockpitHeight;for(var p=0;p<=10;p++){var d=p/10;this.rpath1.push(V(-.5+d,-.05*Math.cos(p*Math.PI/5)-.75,3.1)),this.rpath2.push(V(-.5+d,-1,0)),this.rpath3.push(V(this.rpath1[p].x,this.rpath1[p].y+this.cockpitHeight,this.rpath1[p].z)),this.initialRpath3.push(V(this.rpath1[p].x,this.rpath1[p].y+this.cockpitHeight,this.rpath1[p].z))}this.rpath3[0].y=this.rpath1[0].y,this.rpath3[10].y=this.rpath1[10].y,this.initialRpath3[0].y=this.rpath3[0].y,this.initialRpath3[10].y=this.rpath1[10].y;var g=BABYLON.MeshBuilder.CreateRibbon("rb",{pathArray:[this.rpath1,this.rpath2]},t);this.cockpit=BABYLON.Mesh.MergeMeshes([m,c,l,g],!0,!0),this.cockpit.alwaysSelectAsActiveMesh=!0,this.cockpit.material=SF.Materials.ship,this.cockpit.freezeWorldMatrix(),g=c=l=null,this.pathArray=[this.rpath3,this.rpath1],this.shieldMesh=BABYLON.MeshBuilder.CreateRibbon("sh",{pathArray:this.pathArray,updatable:!0},t),this.shieldMesh.material=SF.Materials.shield,this.shieldMesh.freezeWorldMatrix(),this.shieldMesh.alwaysSelectAsActiveMesh=!0,this.maxShield=e.maxShield,this.shield=this.maxShield},SF.Starship.prototype.resetShield=function(){this.shield=this.maxShield,SF.Materials.shield.diffuseColor.r=0,SF.Materials.shield.diffuseColor.g=1,SF.Materials.shield.alpha=.5;for(var e=0;e<this.initialRpath3.length;e++)this.rpath3[e].copyFrom(this.initialRpath3[e]);BABYLON.MeshBuilder.CreateRibbon(null,{pathArray:this.pathArray,instance:this.shieldMesh})},SF.Starship.prototype.checkLaserHit=function(e){if(e.position.x<this.cockpitArea.x&&e.position.x>-this.cockpitArea.x&&e.position.y<this.cockpitArea.y&&e.position.y>-this.cockpitArea.y){var t=.3*(Math.random()-.5);if(this.gameScene.bumpCamera(t),this.updateShield(Math.abs(t)),this.shield<0){this.resetShield();this.gameScene.scene.sceneManager.notify({emitterName:"game",message:"over"})}}},SF.Starship.prototype.shakeCockpit=function(){},SF.Starship.prototype.updateShield=function(e){this.shield-=e,SF.Materials.shield.diffuseColor.g-=e/this.shield*.8,SF.Materials.shield.diffuseColor.r+=e/this.shield*.8,SF.Materials.shield.alpha+=e/this.shield*.5;for(var t=1;t<this.rpath3.length-1|0;t++)this.rpath3[t].y-=this.cockpitHeight/2*(e/this.shield);BABYLON.MeshBuilder.CreateRibbon(null,{pathArray:this.pathArray,instance:this.shieldMesh})},SF.Weapons=function(e){var t=e.scene,i=e.sightDistance,s=e.canLength,a=e.canRadius;this.gameScene=e,this.sight=BABYLON.MeshBuilder.CreatePlane("sight",{size:.2},t),this.sight.position=V(0,0,i),this.sight.material=SF.Materials.sight,this.sight.alwaysSelectAsActiveMesh=!0;var n=new BABYLON.Vector3(-1.5,-1,2.2),o=[V(0,0,0),V(0,0,.8*s),V(0,0,.8*s),V(0,0,s)],h=BABYLON.MeshBuilder.CreateTube("c0",{path:o,radiusFunction:function(e,t){var i=a;return 2==e&&(i*=1.25),3==e&&(i*=.8),i}},t);h.material=SF.Materials.ship,h.position=n;var r=h.createInstance("c1",t);r.position.x=-h.position.x;var c=h.createInstance("c2",t);c.position.y=-h.position.y;var l=h.createInstance("c3",t);l.position.y=c.position.y,l.position.x=r.position.x,h.alwaysSelectAsActiveMesh=!0,r.alwaysSelectAsActiveMesh=!0,c.alwaysSelectAsActiveMesh=!0,l.alwaysSelectAsActiveMesh=!0,this.cannons=[h,r,c,l],this.cannonDirections=[V(0,0,0),V(0,0,0),V(0,0,0),V(0,0,0)],this.cannonHeats=[0,0,0,0]},SF.Weapons.prototype.animate=function(){var e=this.gameScene;this.sight.position.x=e.pointerDistance.x*e.fovCorrection*e.aspectRatio,this.sight.position.y=e.pointerDistance.y*e.fovCorrection;for(var t=0;t<this.cannons.length;t++)this.sight.position.subtractToRef(this.cannons[t].position,this.cannonDirections[t]),this.cannons[t].rotation.y=Math.atan2(this.cannonDirections[t].x,this.cannonDirections[t].z),this.cannons[t].rotation.x=-Math.atan2(this.cannonDirections[t].y*Math.cos(this.cannons[t].rotation.y),this.cannonDirections[t].z),this.cannonHeats[t]>0|0&&this.cannonHeats[t]--},SF.Enemy=function(e,t,i){this.id=e,this.model=t,this.gameScene=i,this.enemyShield=this.gameScene.enemyShield,this.enemySpeed=this.gameScene.enemySpeed,this.maxShield=6+Math.random()*this.enemyShield|0,this.speed=this.enemySpeed*Math.random(),this.shield=this.maxShield,this.explosion=!1,this.mustRebuild=!1,this.randAng=V(Math.random(),Math.random(),Math.random()),this.initialParticlePositions=[],this.enemyExplosionVelocity=this.gameScene.enemyExplosionVelocity,this.initialAlpha=1.3;var s=this.gameScene.scene,a=new BABYLON.SolidParticleSystem("esps"+this.id,s);a.digest(this.model,{facetNb:12,delta:10}),a.buildMesh(),a.mesh.material=Math.random()<.5?SF.Materials.enemy1:SF.Materials.enemy2,a.mesh.hasVertexAlpha=!1,this.sps=a,this.mesh=a.mesh;for(var n=0;n<a.nbParticles;n++){var o=a.particles[n];this.initialParticlePositions.push(o.position.clone()),o.velocity.copyFrom(o.position),o.velocity.multiplyInPlace(this.randAng),o.velocity.scaleInPlace(this.enemyExplosionVelocity),o.uvs.z=.2,o.uvs.w=.08,o.color.a=this.initialAlpha,o._ind<300?(o.color.r=0,o.color.g=Math.random()<.5?0:.3,o.color.b=Math.random()<.5?0:.3):o._ind<876&&(o.color.r=.55,o.color.g=.5,o.color.b=.5)}a.setParticles(),a.refreshVisibleSize();var h=this;a.updateParticle=function(e){h.explosion&&(e.color.a<1&&(h.mesh.hasVertexAlpha=!0),e.position.addInPlace(e.velocity),e.rotation.x+=e.velocity.z*h.randAng.x,e.rotation.y+=e.velocity.x*h.randAng.y,e.rotation.z+=e.velocity.y*h.randAng.z,e.color.a-=.01,SF.Lights.explosionLight.intensity-=.001,SF.Lights.explosionLight.intensity<.001&&(SF.Lights.explosionLight.intensity=0),e.color.a<.8&&(h.mustRebuild=!0))},this.setRandomPosition()},SF.Enemy.prototype.setRandomPosition=function(){var e=this.mesh;e.position.z=50+10*Math.random(),e.position.y=8*Math.random()-4,e.position.x=4*-this.gameScene.enemyNb+2*this.gameScene.enemyNb*this.id,e.rotation.z=Math.random()*this.id},SF.Enemy.prototype.shoot=function(){for(var e=!0,t=0,i=this.gameScene.enemyLasers.sps,s=i.particles;t<i.nbParticles&&e;)if(s[t].isVisible)t+=2;else for(var a=0;a<2|0;a++)s[t+a].isVisible=!0,s[t+a].position.copyFrom(this.mesh.position),this.mesh.position.scaleToRef(-1,s[t+a].velocity),s[t+a].velocity.normalize(),s[t+a].velocity.scaleInPlace(this.gameScene.enemyLasers.enemyLaserSpeed),s[t+a].color.copyFrom(this.gameScene.enemyLasers.enemyLaserInitialColor),s[t+a].rotation.z=this.gameScene.halfPI*a,e=!1},SF.Enemy.prototype.checkHit=function(e){var t=this.gameScene.aspectRatio,i=this.gameScene.bboxpc,s=this.mesh.position.z*this.gameScene.cameraFov,a=this.mesh.position.x/(s*t),n=this.mesh.position.y/s,o=this.mesh.getBoundingInfo().boundingBox,h=(o.maximumWorld.x-o.minimumWorld.x)*i*.5/(s*t),r=(o.maximumWorld.y-o.minimumWorld.y)*i*.5/s;if(e.screenTarget.x>=a-h&&e.screenTarget.x<=a+h&&e.screenTarget.y>=n-r&&e.screenTarget.y<=n+r){this.shield--;var c=this.gameScene.impacts.sps.particles[e.id];c.isVisible=!0,c.position.x=e.target.x,c.position.y=e.target.y,c.scaling.x=this.gameScene.distance/this.mesh.position.z*1.2,c.scaling.y=c.scaling.x,0===this.shield|0&&this.explode(c)}},SF.Enemy.prototype.explode=function(e){if(this.explosion=!0,e.scaling.x=60,e.position.copyFrom(this.mesh.position),this.gameScene.impacts.explosions[e.idx]=!0,SF.Lights.explosionLight.position.copyFrom(this.mesh.position),SF.Lights.explosionLight.intensity=SF.Lights.explLghtIntensity,this.gameScene.setScore(100),this.gameScene.isCompleted()){this.gameScene.scene.sceneManager.notify({emitterName:"game",message:"completed"})}},SF.Enemy.prototype.rebuild=function(){this.explosion=!1,this.mesh.hasVertexAlpha=!1,this.mustRebuild=!1,this.shield=this.maxShield;for(var e=0;e<this.sps.nbParticles;e++)this.sps.particles[e].position.copyFrom(this.initialParticlePositions[e]),this.sps.particles[e].color.a=this.initialAlpha,this.sps.particles[e].rotation.x=0,this.sps.particles[e].rotation.y=0,this.sps.particles[e].rotation.z=0,this.sps.particles[e].velocity.copyFrom(this.sps.particles[e].position),this.sps.particles[e].velocity.scaleInPlace(Math.random()*this.enemyExplosionVelocity);this.sps.setParticles(),this.speed=this.gameScene.enemySpeed*Math.random(),this.setRandomPosition()},SF.Enemies=function(e){this.gameScene=e,this.enemyNb=this.gameScene.enemyNb,this.enemyFireFrequency=this.gameScene.enemyFireFrequency,this.enemyFireLimit=this.gameScene.enemyFireLimit,this.pool=[];var t=this.gameScene.scene,i=BABYLON.MeshBuilder.CreateCylinder("",{height:.1,tessellation:16,diameter:3.2},t),s=BABYLON.MeshBuilder.CreateCylinder("",{height:.1,tessellation:16,diameter:3.2},t),a=BABYLON.MeshBuilder.CreateCylinder("",{diameter:.5,height:4,subdivisions:2},t),n=BABYLON.MeshBuilder.CreateSphere("",{diameter:2,segments:4},t),o=BABYLON.MeshBuilder.CreateSphere("",{segments:3,diameterX:1,diameterY:1,diameterZ:.2},t),h=BABYLON.MeshBuilder.CreateIcoSphere("",{radius:.5,subdivisions:6},t),r=BABYLON.MeshBuilder.CreateCylinder("",{height:1.4,diameterBottom:.2,diameterTop:.75,tessellation:16,subdivisions:1},t),c=r.clone(),l=r.clone(),m=r.clone();r.rotation.x=this.gameScene.halfPI,c.rotation.x=this.gameScene.halfPI,l.rotation.x=this.gameScene.halfPI,m.rotation.x=this.gameScene.halfPI,r.position.x=-.5,r.position.y=.5,r.position.z=.2,c.position.x=.5,c.position.y=.5,c.position.z=.2,l.position.y=-.5,l.position.z=.2,m.scaling.y=.9,m.scaling.z=.9,m.scaling.x=.9,a.rotation.z=this.gameScene.halfPI,i.rotation.z=this.gameScene.halfPI,s.rotation.z=-this.gameScene.halfPI,i.position.x=2,s.position.x=-2,o.position.z=-1;for(var p=BABYLON.Mesh.MergeMeshes([o,r,c,l,h,a,m,m,m,n,i,s],!0,!0),d=0;d<this.enemyNb;d++)this.pool[d]=new SF.Enemy(d,p,this.gameScene);p.dispose()},SF.Enemies.prototype.checkHit=function(e){for(var t=0;t<this.enemyNb;t++)this.pool[t].checkHit(e)},SF.Enemies.prototype.animate=function(){for(var e=0,t=0,i=0,s=1,a=0;a<this.enemyNb;a++){var n=this.pool[a];n.explosion?n.mustRebuild?(n.rebuild(),n.randAng.multiplyByFloats(Math.random(),Math.random(),Math.random())):n.sps.setParticles():(s=a%2==0?1:-1,i=1e-4*Date.now()*s*n.speed,e=(t=n.mesh.position.z*this.gameScene.cameraFov*2)*this.gameScene.aspectRatio,n.mesh.position.x<-e&&(n.mesh.position.x=-e),n.mesh.position.x>e&&(n.mesh.position.x=e),n.mesh.position.y<-t&&(n.mesh.position.y=-t),n.mesh.position.y>t&&(n.mesh.position.y=t),n.mesh.rotation.z+=Math.sin(i)/(10+5*a)*n.speed,n.mesh.rotation.y+=Math.sin(i)/(10+5*a)/8,n.mesh.position.z=this.gameScene.sightDistance+this.gameScene.distance*(1+Math.sin(i+a)),n.mesh.position.x+=Math.cos(i-a)/5,n.mesh.position.y+=Math.sin(i+a/2)/8),n.mesh.position.x-=this.gameScene.pointerDistance.x*n.mesh.position.z/this.gameScene.distance,n.mesh.position.y-=this.gameScene.pointerDistance.y*n.mesh.position.z/this.gameScene.distance,Math.random()<this.enemyFireFrequency&&n.mesh.position.z>this.enemyFireLimit&&!n.explosion&&n.shoot()}},SF.EnemyLasers=function(e){this.gameScene=e,this.enemyLaserNb=this.gameScene.enemyLaserNb,this.enemyLaserSpeed=this.gameScene.enemyLaserSpeed,this.enemyLaserInitialColor=this.gameScene.enemyLaserInitialColor,this.enemyFireFrequency=this.gameScene.enemyFireFrequency,this.enemyFireLimit=this.gameScene.enemyFireLimit;var t=this.gameScene.scene,i=BABYLON.MeshBuilder.CreatePlane("elm",{size:.2},t),s=new BABYLON.SolidParticleSystem("elsps",t);s.addShape(i,this.enemyLaserNb),s.buildMesh(),this.sps=s,this.mesh=s.mesh,s.mesh.material=SF.Materials.star;for(var a=0;a<this.enemyLaserNb;a++){var n=s.particles[a];n.isVisible=!1,n.color.copyFrom(this.enemyLaserInitialColor)}s.setParticles(),s.isAlwaysVisible=!0,s.computeParticleTexture=!1;var o=this.gameScene.pointerDistance,h=this.gameScene.distance,r=this.gameScene.cockpitArea,c=this.gameScene.starship;s.updateParticle=function(e){e.isVisible&&(e.position.addInPlace(e.velocity),e.position.x+=o.x*e.position.z*e.velocity.z/h,e.position.y+=o.y*e.position.z*e.velocity.z/h,e.rotation.z+=.66,e.scaling.x=2+r.z/e.position.z*4,e.scaling.y=4*e.scaling.x,e.color.a+=.005,e.color.r+=.01,e.color.g+=.01,e.color.a>.9&&(e.color.a=.9),e.color.r>1&&(e.color.r=1),e.color.g<0&&(e.color.g=0),e.position.z<r.z&&(e.isVisible=!1,c.checkLaserHit(e)))}},SF.EnemyLasers.prototype.animate=function(){this.sps.setParticles()},SF.Stars=function(e){this.starNb=e.starNb,this.starEmitterSize=e.starEmitterSize,this.distance=e.distance,this.starZLimit=e.sightDistance,this.moderation=e.moderation,this.pointerDistance=e.pointerDistance,this.ang=e.ang,this.rotMatrix=e.rotMatrix,this.speedVector=e.speedVector,this.tmpSpeed=e.tmpSpeed,this.canvas=e.canvas,this.material=SF.Materials.star;var t=e.scene,i=new BABYLON.SolidParticleSystem("stars",t),s=BABYLON.MeshBuilder.CreatePlane("p",{size:.2},t);i.addShape(s,this.starNb),s.dispose(),i.buildMesh(),this.sps=i,this.mesh=this.sps.mesh,i.mesh.material=this.material,i.mesh.hasVertexAlpha=!0,i.mesh.freezeNormals(),i.mesh.freezeWorldMatrix(),i.isAlwaysVisible=!0,i.computeParticleRotation=!1,i.computeParticleTexture=!1;for(var a=i.particles,n=0;n<this.starNb;n++)a[n].position.x=this.starEmitterSize*(Math.random()-.5),a[n].position.y=this.starEmitterSize*(Math.random()-.5),a[n].position.z=this.distance*Math.random(),a[n].velocity.z=1.1-.2*Math.random();i.setParticles();var o=this.distance,h=this.starZLimit,r=this.starEmitterSize,c=this.pointerDistance,l=this.canvas,m=this.ang,p=1/this.moderation,d=this.rotMatrix,g=this.speedVector,S=this.tmpSpeed;i.beforeUpdateParticles=function(){t.pointerX&&(c.x=2*t.pointerX/l.width-1,m.y=Math.atan(c.x)),t.pointerY&&(c.y=1-2*t.pointerY/l.height,m.x=Math.atan(c.y)),BABYLON.Matrix.RotationYawPitchRollToRef(m.y*p,m.x*p,0,d),BABYLON.Vector3.TransformCoordinatesToRef(g,d,S)},i.updateParticle=function(e){e.position.addInPlace(S),e.position.x-=c.x*e.position.z*e.velocity.z/o,e.position.y-=c.y*e.position.z*e.velocity.z/o,e.position.z<h&&(e.position.z=o*(1-.25*Math.random()),e.position.x=r*(Math.random()-.5)+o*c.x*.5,e.position.y=r*(Math.random()-.5)+o*c.y*.5,e.scaling.x=1.1-.2*Math.random(),e.scaling.y=e.scaling.x,e.velocity.z=1.1-.2*Math.random())}},SF.Stars.prototype.animate=function(){this.sps.setParticles()},SF.LogicalLaser=function(e,t){this.id=t,this.mesh=e.particles[t],this.target=V(0,0,0),this.direction=V(0,0,0),this.fired=!1,this.cannon=0,this.scaling=0,this.screenTarget=BABYLON.Vector2.Zero()},SF.ShipLasers=function(e){this.gameScene=e;var t=this.gameScene.scene;this.distance=this.gameScene.distance,this.canRadius=this.gameScene.canRadius,this.canLength=this.gameScene.canLength,this.laserNb=this.gameScene.laserNb,this.laserSpeed=this.gameScene.laserSpeed,this.ballRadius=8*this.canRadius,this.ballPos=V(0,0,0),this.targetAxis=V(0,0,0),this.axis2=V(0,0,0),this.axis3=V(0,0,0),this.fired=!1,this.cannons=this.gameScene.weapons.cannons,this.cannonHeats=this.gameScene.weapons.cannonHeats,this.cannonDirections=this.gameScene.weapons.cannonDirections,this.fireHeat=this.gameScene.fireHeat,this.pointerDistance=this.gameScene.pointerDistance,this.sight=this.gameScene.weapons.sight,this.camera=this.gameScene.camera,this.fovCorrection=this.gameScene.fovCorrection,this.laserLightInitialColor=this.gameScene.laserLightInitialColor,this.lightDistance=this.gameScene.lightDistance,this.ballFovCorrection=this.gameScene.ballFovCorrection;var i=[2*-this.canRadius,-1,0,2*this.canRadius,-1,0,0,0,0],s=[0,1,2],a=[];BABYLON.VertexData.ComputeNormals(i,s,a);var n=new BABYLON.VertexData;n.positions=i,n.indices=s,n.normals=a,n.colors=[1,1,1,1,1,1,1,1,0,0,1,1];var o=new BABYLON.Mesh("l",t);n.applyToMesh(o);var h=BABYLON.MeshBuilder.CreateDisc("lb",{radius:1,tessellation:24,updatable:!0},t),r=new Float32Array(108);r[0]=.5,r[1]=.5,r[2]=1,r[3]=.8;for(var c=1;c<27;c++)r[4*c|0]=.5,r[1+(4*c|0)|0]=.5,r[2+(4*c|0)|0]=1,r[3+(4*c|0)|0]=.7;h.setVerticesData(BABYLON.VertexBuffer.ColorKind,r);var l=new BABYLON.SolidParticleSystem("lsps",t);l.addShape(o,this.laserNb),l.addShape(h,this.laserNb),l.buildMesh(),o.dispose(),h.dispose(),l.isAlwaysVisible=!0,l.computeParticleColor=!1,l.computeParticleTexture=!1,l.mesh.hasVertexAlpha=!0,l.mesh.material=SF.Materials.laser;var m=BABYLON.MeshBuilder.CreatePlane("llmd",{size:.2},t),p=new BABYLON.SolidParticleSystem("llsps",t);p.addShape(m,this.laserNb),p.buildMesh(),m.dispose(),p.isAlwaysVisible=!0,p.computeParticleTexture=!1,p.mesh.hasVertexAlpha=!0,p.mesh.material=SF.Materials.star;for(var d=0;d<this.laserNb;d++){var g=p.particles[d];g.isVisible=!1,g.position.z=this.lightDistance,g.velocity.z=.5,g.color.copyFrom(this.laserLightInitialColor),g.scaling.x=this.distance/this.lightDistance*1.2,g.scaling.y=g.scaling.x}p.setParticles();var S,u,y=this.pointerDistance,L=this.distance;p.updateParticle=function(e){e.isVisible&&(e.position.z+=e.velocity.z,e.position.x-=y.x*e.position.z*e.velocity.z/L,e.position.y-=y.y*e.position.z*e.velocity.z/L,e.position.z>L&&(e.isVisible=!1))};for(var x=[],B=0;B<2*this.laserNb|0;B++)(S=new SF.LogicalLaser(l,B)).mesh.isVisible=!1,S.mesh.scaling.y=0,S.mesh.scaling.x=0,S.mesh.position.z=this.sightDistance,x.push(S);var f=this.laserNb,v=this.laserSpeed,M=this.canLength,F=this.ballPos,A=this.cannons;e=this.gameScene;l.updateParticle=function(t){t.isVisible&&t.idx<f&&(S=x[t.idx],u=x[t.idx+f],t.scaling.y*=v,t.scaling.x*=v,u.mesh.scaling.x*=v,u.mesh.scaling.x<.02?u.mesh.scaling.x=0:(S.direction.scaleToRef(M+.03*(1-.5*Math.random())/t.scaling.x,F),u.mesh.position.copyFrom(F.addInPlace(A[S.cannon].position))),u.mesh.scaling.y=u.mesh.scaling.x,t.scaling.y<=.01&&(t.scaling.y=0,S.fired=!1,u.fired=!1,t.isVisible=!1,e.enemies.checkHit(S)))},this.pool=x,this.sps=l,this.laserLightSPS=p,this.mesh=l.mesh},SF.ShipLasers.prototype.animate=function(){var e=0,t=!0,i=0|4*Math.random(),s=SF.Lights.pointLight;if(s.intensity-=.1,s.intensity<0&&(s.intensity=0),this.fired&&0==this.cannonHeats[i]|0)for(this.cannonHeats[i]=this.fireHeat;e<this.laserNb&&t;){var a=this.pool[e],n=this.pool[e+this.laserNb],o=this.laserLightSPS.particles;if(a.fired)e++;else{this.starNb;a.fired=!0,a.mesh.isVisible=!0,n.mesh.isVisible=!0,a.cannon=i,n.cannon=i,a.screenTarget.copyFromFloats(this.pointerDistance.x,this.pointerDistance.y),a.target.copyFrom(this.sight.position),a.direction.copyFrom(this.cannonDirections[i]),a.scaling=a.direction.length(),a.direction.normalize(),a.mesh.position.copyFrom(a.target),a.target.subtractToRef(this.camera.position,this.targetAxis),BABYLON.Vector3.CrossToRef(a.direction,this.targetAxis,this.axis3),BABYLON.Vector3.CrossToRef(this.targetAxis,this.axis3,this.axis2),BABYLON.Vector3.RotationFromAxisToRef(this.axis3,this.axis2,this.targetAxis,a.mesh.rotation),a.mesh.scaling.y=a.scaling*this.fovCorrection/this.laserSpeed,a.mesh.scaling.x=1,n.mesh.scaling.x=this.ballRadius*(1.2-.8*Math.random()),n.mesh.scaling.y=n.mesh.scaling.x,a.direction.scaleToRef(this.canLength+.05*Math.random(),this.ballPos),n.mesh.position.copyFrom(this.ballPos.addInPlace(this.cannons[i].position)),o[e].isVisible=!0,o[e].position.x=this.pointerDistance.x*this.ballFovCorrection*this.gameScene.aspectRatio,o[e].position.y=this.pointerDistance.y*this.ballFovCorrection,o[e].position.z=this.lightDistance,s.position.copyFrom(n.mesh.position),s.intensity=SF.Lights.pointLightMaxIntensity,t=!1}}this.sps.setParticles(),this.laserLightSPS.setParticles()},SF.Impacts=function(e){this.gameScene=e,this.impactNb=this.gameScene.laserNb,this.impactInitialColor=this.gameScene.impactInitialColor,this.explosionInitialColor=this.gameScene.explosionInitialColor,this.explosions=[];var t=this.gameScene.scene,i=BABYLON.MeshBuilder.CreatePlane("imdl",{size:.2},t),s=new BABYLON.SolidParticleSystem("isps",t);s.addShape(i,this.impactNb),s.buildMesh(),i.dispose();for(var a=0;a<s.nbParticles;a++)s.particles[a].isVisible=!1,s.particles[a].position.z=this.gameScene.sightDistance,s.particles[a].color.copyFrom(this.impactInitialColor),this.explosions.push(!1);s.setParticles(),s.mesh.freezeNormals(),s.isAlwaysVisible=!0,s.mesh.hasVertexAlpha=!0,s.computeParticleRotation=!1,s.computeParticleTexture=!1,s.mesh.material=SF.Materials.impact,this.sps=s,this.mesh=this.sps.mesh;var n=this.impactInitialColor,o=this.explosions;e=this.gameScene;s.updateParticle=function(t){t.isVisible&&(t.position.x-=e.pointerDistance.x*t.position.z/e.distance,t.position.y-=e.pointerDistance.y*t.position.z/e.distance,o[t.idx]?(t.scaling.x*=1+.5*Math.random(),t.scaling.y=t.scaling.x/(1.1+Math.random()),t.color.r=e.explosionInitialColor.r-.1*Math.random(),t.color.g=e.explosionInitialColor.g-.1*Math.random(),t.color.b=e.explosionInitialColor.b,t.color.a-=.07,t.color.a<.01&&(t.isVisible=!1,t.position.z=e.sightDistance,t.color.copyFrom(n),o[t.idx]=!1)):(t.color.a-=.01,t.scaling.x-=.1,t.scaling.y=t.scaling.x,t.scaling.x<.01&&(t.isVisible=!1,t.color.copyFrom(n))))}},SF.Impacts.prototype.animate=function(){this.sps.setParticles()},SF.GameScene=function(e,t,i){this.starNb=150,this.distance=60,this.starSpeed=1,this.starEmitterSize=this.distance/1.2,this.maxPlanetNb=5,this.sightDistance=5,this.canLength=.4,this.canRadius=.04,this.maxShield=6,this.laserNb=12,this.laserSpeed=.52,this.fireHeat=15,this.cockpitArea=V(1,1,2.5),this.cockpitHeight=.14,this.laserLightInitialColor=new BABYLON.Color4(.4,.4,1,.8),this.enemyNb=10,this.enemySpeed=3,this.enemyExplosionVelocity=1.15,this.enemyLaserNb=60,this.enemyLaserSpeed=2,this.enemyShield=8,this.enemyFireFrequency=.15,this.enemyFireLimit=4*this.sightDistance,this.enemyLaserInitialColor=new BABYLON.Color4(.8,0,0,.5),this.impactInitialColor=new BABYLON.Color4(.6,.6,1,.85),this.explosionInitialColor=new BABYLON.Color4(1,1,0,1),this.bboxpc=.75,this.ouchX=!1,this.ouchY=!1,this.ouchZ=!1,this.camToLeft=!1,this.tmpCam=V(0,0,0),this.camShakeSpeed=.01,this.camRestoreSpeed=.008,this.returnCamX=!1,this.returnCamY=!1,this.returnCamZ=!1,this.canvas=e,this.scene=void 0,this.camera=void 0,this.engine=t,this.game=i,this.alive=!0,this.killed=0,this.cameraFov=0,this.fovCorrection=0,this.aspectRatio=0,this.halfPI=.5*Math.PI,this.lightDistance=.66*this.distance,this.ballFovCorrection=0,this.rotMatrix=BABYLON.Matrix.Zero(),this.quaternion=BABYLON.Quaternion.Zero(),this.ang=BABYLON.Vector2.Zero(),this.moderation=6,this.pointerDistance=BABYLON.Vector2.Zero(),this.speedVector=V(0,0,-this.starSpeed),this.tmpSpeed=V(0,0,0),this.canPos=new BABYLON.Vector3(-1.5,-1,2.2),this.angShift=Math.atan(this.canPos.y/this.distance),this.keyboard=[],this.pressedPointer=[],this.keys={CTRL:17,SHIFT:16},this.pointer={left:!1};var s=this.keyboard,a=this.pointer,n=this.keys;function o(e,t){e.keyCode==n.CTRL&&(s[n.CTRL]=t),e.keyCode==n.SHIFT&&(s[n.SHIFT]=t),0===e.button&&(a.left=t)}var h=new BABYLON.Scene(t);h.clearColor=BABYLON.Color3.Black(),this.scene=h,h.onKeyboardObservable.add(function(e){o(e.event,!0)},BABYLON.KeyboardEventTypes.KEYDOWN),h.onKeyboardObservable.add(function(e){o(e.event,!1)},BABYLON.KeyboardEventTypes.KEYUP),h.onPointerObservable.add(function(e){o(e.event,!0)},BABYLON.PointerEventTypes.POINTERDOWN),h.onPointerObservable.add(function(e){o(e.event,!1)},BABYLON.PointerEventTypes.POINTERUP);var r=new BABYLON.TargetCamera("camera",V(0,0,0),h);r.direction=V(0,0,1),this.cameraFov=Math.tan(.5*r.fov),this.camera=r,this.fovCorrection=this.cameraFov*this.sightDistance,this.aspectRatio=t.getAspectRatio(r),this.ballFovCorrection=this.cameraFov*this.lightDistance,this.gui=new SF.GUI(h),SF.CreateLights(h);var c=SF.Lights.light;this.light=c,this.initialSpaceLightDirection=SF.Lights.spaceLight.direction.clone(),SF.CreateMaterials(h),this.universe=new SF.Universe(this),c.excludedMeshes=[this.universe.mesh],SF.Lights.pointLight.excludedMeshes=[this.universe.mesh],SF.Lights.explosionLight.excludedMeshes=[this.universe.mesh],SF.Lights.spaceLight.excludedMeshes=[this.universe.mesh];var l=1+Math.floor(this.maxPlanetNb*Math.random());this.planets=new SF.Planets(this,l),c.excludedMeshes.push(this.planets.mesh),SF.Lights.pointLight.excludedMeshes.push(this.planets.mesh),SF.Lights.explosionLight.excludedMeshes.push(this.planets.mesh),this.starship=new SF.Starship(this),this.weapons=new SF.Weapons(this),SF.Lights.spaceLight.excludedMeshes.push(this.weapons.sight),this.shipLasers=new SF.ShipLasers(this),c.excludedMeshes.push(this.shipLasers.mesh),c.excludedMeshes.push(this.shipLasers.laserLightSPS.mesh),SF.Lights.spaceLight.excludedMeshes.push(this.shipLasers.laserLightSPS.mesh),this.stars=new SF.Stars(this),c.excludedMeshes.push(this.stars.mesh),SF.Lights.spaceLight.excludedMeshes.push(this.stars.mesh),this.enemies=new SF.Enemies(this),this.enemyLasers=new SF.EnemyLasers(this),c.excludedMeshes.push(this.enemyLasers.mesh),SF.Lights.spaceLight.excludedMeshes.push(this.enemyLasers.mesh),this.impacts=new SF.Impacts(this),c.excludedMeshes.push(this.impacts.mesh),SF.Lights.spaceLight.excludedMeshes.push(this.impacts.mesh);var m=this;h.registerBeforeRender(function(){m.alive&&(m.setCamera(),m.getInputs(),m.stars.animate(),m.universe.animate(),m.planets.animate(),m.weapons.animate(),m.shipLasers.animate(),m.enemies.animate(),m.enemyLasers.animate(),m.impacts.animate())})},SF.GameScene.prototype.getInputs=function(){this.shipLasers.fired=!(!this.keyboard[this.keys.SHIFT]&&!this.pointer.left)},SF.GameScene.prototype.setCamera=function(){this.aspectRatio=this.engine.getAspectRatio(this.camera),this.light.diffuse.b+=.1,this.light.diffuse.g+=.1,this.light.intensity-=.01,this.light.diffuse.b>1&&(this.light.diffuse.b=1),this.light.diffuse.g>1&&(this.light.diffuse.g=1),this.light.intensity<SF.Lights.lightInitialIntensity&&(this.light.intensity=SF.Lights.lightInitialIntensity),this.ouchY&&(this.camera.position.y<this.tmpCam.y&&!this.returnCamY?this.camera.position.y+=this.camShakeSpeed:(this.camera.position.y-=this.camRestoreSpeed,this.returnCamY=!0,this.camera.position.y<=0&&(this.camera.position.y=0,this.ouchY=!1,this.returnCamY=!1))),this.ouchZ&&(this.camera.position.z>this.tmpCam.z&&!this.returnCamZ?this.camera.position.z-=this.camShakeSpeed:(this.camera.position.z+=this.camRestoreSpeed,this.returnCamZ=!0,this.camera.position.z>=0&&(this.camera.position.z=0,this.ouchZ=!1,this.returnCamZ=!1))),this.ouchX&&(this.camToLeft?this.camera.position.x>this.tmpCam.x&&!this.returnCamX?this.camera.position.x-=this.camShakeSpeed:(this.camera.position.x+=this.camRestoreSpeed,this.returnCamX=!0):this.camera.position.x<this.tmpCam.x&&!this.returnCamX?this.camera.position.x+=this.camShakeSpeed:(this.camera.position.x-=this.camRestoreSpeed,this.returnCamX=!0),Math.abs(this.camera.position.x)<this.camRestoreSpeed&&this.returnCamX&&(this.camera.position.x=0,this.ouchX=!1,this.returnCamX=!1))},SF.GameScene.prototype.bumpCamera=function(e){this.tmpCam.copyFromFloats(e,.1*Math.random(),.1*-Math.random()),this.ouchX=!0,this.ouchY=!0,this.ouchZ=!0,this.camToLeft=!1,this.returnCamX=!1,this.returnCamY=!1,this.returnCamZ=!1,this.tmpCam.x<0&&(this.camToLeft=!0),this.light.diffuse.b=0,this.light.diffuse.g=.5,this.light.intensity=1},SF.GameScene.prototype.setScore=function(e){this.game.killed++,this.game.score+=e,this.gui.score.text=this.gui.pad(this.game.score,6)},SF.GameScene.prototype.resetScore=function(){this.gui.score.text=this.gui.pad(0,6)},SF.GameScene.prototype.isCompleted=function(){return this.game.killed>=this.game.goal},BABYLON.Scene.prototype.setSceneManager=function(e){this.sceneManager=e},SF.LevelScene=function(e,t){this.game=t,this.scene=new BABYLON.Scene(e),this.scene.clearColor=BABYLON.Color3.Black(),this.camera=new BABYLON.TargetCamera("cam",BABYLON.Vector3.Zero(),this.scene),this.camera.direction=V(0,0,1),SF.CreateMaterials(this.scene),this.distance=60;var i=this.scene;this.universe={mesh:BABYLON.MeshBuilder.CreatePlane("p",{size:50},i)},this.universe.mesh.position.z=10,this.universe.mesh.material=SF.Materials.universe,this.light=new BABYLON.HemisphericLight("LLight",V(0,0,-1),this.scene),this.light.excludedMeshes=[this.universe.mesh],this.messageScreen=new SF.MessageScreen(e),this.title="LEVEL 1",this.message="Destroy "+String(this.game.goal)+" "+this.game.enemyName,this.messageScreen.setHTMLText(this.title,this.message);var s=this;this.notificationMsg={level:s.level,emitterName:"level",message:"completed",emitter:s},this.animation=!1,this.scene.onPointerObservable.add(function(e){s.animation=!0},BABYLON.PointerEventTypes.POINTERDOWN),this.scene.registerBeforeRender(function(){var e=s.messageScreen.board;s.animation?(e.position.z+=.1,e.rotation.x+=.1,e.position.z>10&&(s.animation=!1,s.scene.sceneManager.notify(s.notificationMsg))):(e.position.copyFrom(s.messageScreen.boardInitialLocation),e.rotation.x=0)})},SF.LevelScene.prototype.nextLevel=function(){var e=this.game;e.level++;var t=e.level>e.goalMaxNb?e.goalMaxNb-1:e.level-1;e.goal=e.goals[t],this.animation=!1,this.notificationMsg.message="completed",this.title="LEVEL "+String(e.level),this.message="Destroy "+String(e.goal)+" "+this.game.enemyName,this.messageScreen.setHTMLText(this.title,this.message),this.game.gameScene.starship.resetShield()},SF.LevelScene.prototype.gameOver=function(){this.notificationMsg.message="restart",this.title="GAME OVER",this.message="Final score : "+this.game.score,this.messageScreen.setHTMLText(this.title,this.message)},SF.MessageScreen=function(e){this.title="",this.text="",this.board=BABYLON.MeshBuilder.CreatePlane("board",{},this.scene),this.boardInitialLocation=V(0,0,1),this.board.position.copyFrom(this.boardInitialLocation);var t=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(this.board,1024,1024),i=new BABYLON.GUI.TextBlock;i.text=this.text,i.color="black",i.outlineColor="white",i.outlineWidth=6,i.fontSize=120,i.fontStyle="bold",i.textVerticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,i.top="-50px",t.addControl(i);var s=new BABYLON.GUI.TextBlock;s.text=this.text,s.color="white",s.fontSize=60,s.textVerticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,s.top="80px",t.addControl(s),this.textBlock=s,this.titleBlock=i},SF.MessageScreen.prototype.setHTMLText=function(e,t){this.text=t,this.textBlock.text=this.text,this.title=e,this.titleBlock.text=this.title},SF.SceneManager=function(){this.scenes={},this.sceneNb=0,this.currentScene=void 0},SF.SceneManager.prototype.addScene=function(e,t){this.scenes[e]=t,0==this.sceneNb&&(this.currentScene=t),t.setSceneManager(this),this.sceneNb++},SF.SceneManager.prototype.removeScene=function(e){this.scene[e]=null,this.sceneNb--,this.sceneNb<0&&(this.sceneNb=0,this.currentScene=null)},SF.SceneManager.prototype.renderCurrentScene=function(){this.currentScene.render()},SF.SceneManager.prototype.notify=function(e){var t=this.scenes.level;if("level"==e.emitterName){switch(e.message){case"completed":this.currentScene=this.scenes.game;break;case"restart":SF.score=0,SF.level=0,this.scenes.game.logicalScene.resetScore(),t.logicalScene.nextLevel()}SF.killed=0}if("game"==e.emitterName){switch(e.message){case"completed":t.logicalScene.nextLevel();break;case"over":t.logicalScene.gameOver()}this.currentScene=t}};var init=function(e){var t=document.querySelector("#renderCanvas"),i=new BABYLON.Engine(t,!0),s=new e.SceneManager,a=new e.LevelScene(i,e),n=new e.GameScene(t,i,e),o=a.scene,h=n.scene;o.logicalScene=a,h.logicalScene=n,e.gameScene=n,e.levelScene=a,s.addScene("game",h),s.addScene("level",o);var r=s.scenes.level;s.currentScene=r,window.addEventListener("resize",function(){i.resize()}),i.runRenderLoop(function(){s.renderCurrentScene()})};